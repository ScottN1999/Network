# Scalability and HA


## Scalability

## Vertical Scaling
- Resizing EC2 instance
- t3.large â†’ t3.xlarge
- Each resize requires a reboot - disruption
- Larger instances often carry a $ premium
- There is an upper cap on performance - instance size
- No application modification required
- Works for ALL applications - even monoliths

## Horizontal Scaling
- Adds more instances as load increases
- Load Balancer Between servers and customers
- Distribute load over all servers
- Sessions, sessions, sessions
- Requires application support OR off-host sessions (stateless sessions)
- No disruption when scaling
- Connections can be moved between servers (if stateless sessions without disruption)
- Often less expensive - no large instance premium
- More granular

## HA

High availability refers to ensuring the service continues without fault, this usually can be implemented by spreading EC2s across different AZs - HA does not equate to scalability however horizontal scaling does follow the same principals.

## Application Load Balancer (ALB)

- **Layer 7** load balancer
    - Listens on **HTTP/HTTPS**
- **No other Layer 7 protocols (**SMTP, SSH, Gaming)
    - And **NO TCP/UDP/TLS Listeners**
- L7 content type, cookies, custom headers, user location and app behaviour
- HTTP HTTPS (SSL/TLS) always terminated on the ALB - **no unbroken SSL** (security teams!)
    - **A new connection is made to the application**
- ALBs **MUST** have **SSL** certs if **HTTPS** is used
- ALBs are **slower** than **NLB**. More levels of the networks stack to process
- Health checks **evaluate application health**
    - Layer 7

## ALB Rules

- Rules **direct connections** which arrive at a listener
- Processed in **priority order**
- **Default rule = catchall**
- **Rule Conditions:** host-header, http-header, http-request-method, path-pattern, query-string and source-ip
- **Actions:** forwards, redirects, fixed-response, authenticate-oids & authenticate-cognito

## Network Load Balancer NLB

- Operates layer 4
- Forward TCP & UDP traffic to your instances
- Handle millions of request per second
- Less latency ~ 100MS (vs 400 ms for ALB)

NLB has one static IP per AZ, and supports assigning Elastic IP (helpful for whitelisting specific IP). NLB are used for **extreme performance, TCP or UDP** (Not included in the AWS free tier).

<img width="431" alt="image" src="https://github.com/UpheldSmile/Virtual-Network/assets/49825639/0722e0a2-33f0-4b1e-85b0-5d65fcce7513">

## Target groups for NLB

- EC2s
- Can register IP addresses (must be private and static)
- Application Load Balancer (use case: fixed IP address from NLB, and then can leverage ALB for all HTTP related rules you get from the ALB).
- Health checks support the TCP, HTTP, and HTTPS protocol.

<img width="414" alt="image" src="https://github.com/UpheldSmile/Virtual-Network/assets/49825639/961951dd-c684-4d3c-b1ca-bbca4e6167d3">

## Gateway Load Balancer

Deploy, scale, and manage a fleet of 3rd party network virtual appliances. Use case: firewalls, IDS + IPS, Deep packet inspection systems, payload manipulation

<img width="261" alt="image" src="https://github.com/UpheldSmile/Virtual-Network/assets/49825639/a80c7c08-b862-4daf-bd03-4cf1c8a8ea23">

Operates at Layer 3 (network layer) - IP Packets > combines the following functions:
- Transparent Network Gateway - single entry/exit for all traffic
- Load Balancer - distributes traffic to your virtual appliances

Use the GENEVE protocol on port 6081

## Target groups for GWLB

- EC2 instances
- Ip addresses - must be private

## Sticky Sessions ( Session Affinity )

It is possible to implement stickiness so that the same client is always redirected to the same instance behind a load balancer. This works for CLB, ALP, and NLB.

The 'cookie' used for stickiness has an expiration date you can control (not a requirement for a NLB (WORKS WITHOUT)). Use case: make sure the user doesn't lose his session data > enabling stickiness may bring imalance to the load over the backend EC2 instances.

## Cookies
There is two types:

1. Application-based cookies
   
    - Custom cookies
        - Generated by the target
        - Can include any custom attributes required by the application
        - Cookie name must be specified individually for each target group
        - Don't use AWSALB, AWSALBAPP, or AWSALBTG (reserved for use by the ELB)
    - Application cookies
        - Generated by the load balancer
        - cookie name is AWSALBAPP
          
3. Duration-based cookies
    - Cookie generate by the ELB
    - Cookie name is AWSALB for ALB, ASWSELB for CLB
    - Expiry based by the ELB, Application based is specified by the application itself
  
   
