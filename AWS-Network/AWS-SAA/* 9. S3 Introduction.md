## Amazon S3
S3 is the main building blocks of AWS, it's advertised as "infinitely scaling" storage. Many websites use S3 as a backbone - many AWS services use S3 as an integration as well.

**Use case of S3**
- Backup and storage
- DR
- Archiving files
- Hybrid cloud storage (on prem + cloud)
- Application hosting
- Media hosting
- Data lakes and big data analytics
- Software delivery
- Static website

Nasdaq stores 7 yrs of data into S3 glacier

## Buckets

S3 allows people to store objects (files) in "buckets" (directories), buckets must have a globally unique name (across all regions all accounts). S3 looks like a global service but buckets are created in a region
Naming convention:
- No uppercase, no underscore
- 3-63 char long
- Not and IP
- Must start with lowercase letter or number
- Must NOT start with prefix xn--
- Must NOT end with the suff -s3alias

## Objects
Objects (files) have a Key. The **KEY** is the **_FULL_** path:
- s3://my-bucket/**my_file.txt**
- s3://my-bucket/**my_folder1/another_folder/my_file.txt** (for nested folders)

The key is composed of **prefix** + _object name_
- s3://my-bucket/**my_folder/another_folder/**_my_file.txt_

There's no concept of "directories" within buckets (although the UI will trick you to think otherwise). There is just keys with very long names that contain slashes.

## Objects cont.

- Object value are the content of the body:
  - Max object size is 5tb
  - If uploading more than 5gb, must use "multi-part upload"

- Metadata (list of text key / value pairs - up to 10) - useful for security / lifecycle
- Version ID (if versioning is enabled)

## S3 Security
- User-based
  - IAM Policies - which API calls should be allows for specific user from IAM

- Resource-based
  - Buck Policies (most common) - bucket wide rules from the S3 console - allows cross account
  - Object Access Control list (ACL) - finer grain (can be disabled)
  - Bucket Access Control List (ACL) - less common (can be diabled)

 Note: an IAM principal can access and S3 object if
  - The user IAM permissions **ALLOW** it OR the resource policy **ALLOWS** it
  - **AND** there's no explicit DENY

Encryption: Encrypt objects in S3 using encryption keys

## S3 Bucket Policies
JSON based policy:
- Resources: buckets and objects
- Effect: Allow/Deny
- Actions: Set of API to allow or deny
- Principal: the account or user to apply the policy to

<img width="183" alt="image" src="https://github.com/UpheldSmile/Virtual-Network/assets/49825639/b0077ba8-5bd8-43a8-8a1c-5502ff5bccde">

Use S3 Bucket for policy to:
- Grant public access to the bucket (as shown above)
- Force objecys to be encrypted at upload
- Grant access to another account (cross account)

Bucket setting for block public access - these setting were created to prevent data leaks, if S3 bucket isn't meant to be public leave it on.

## How S3 can be make static websites

